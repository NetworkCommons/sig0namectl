<html>
  <head>
        <title>Go<>JS Demo</title>
		<meta charset="utf-8"/>
		<script type="application/javascript" src="wasm_exec.js"></script>
		<script type="application/javascript" src="pure.js"></script>
	</head>
	<body>
		<h2>DNS</h2>
      		<h3>DOH Resolver</h3>
	  	<p>
			  <input type="text" id="query-name" placeholder="mythingymajig.zenr.io">
			  <input type="text" id="query-type" placeholder="A">
			  <button onclick="queryRaw()">Resolve</button>
			  <pre id="query-result"></pre>
		</p>

		<h2>DNS Keys</h2>
      		<h3>List Keystore</h3>
     		<button onclick="listKeys()">Update</button>
     		<button onclick="listKeysWithStatus()">Update with DNS Status</button>
		<div id="existing-keys"></div>


		<h3>Request</h3>
	  	<p>
			  <input type="text" id="new-name" placeholder="mythingymajig.zenr.io">
			  <button onclick="requestKey()">Request new Key</button>
		</p>
		<h3>Search Keystore for Key to sign update for a given Subdomain</h3>
		<p>
			  <input type="text" id="keys-for-domain" placeholder="mythingymajig.zenr.io">
			  <button onclick="getKeysForDomain()">Find key in keystore</button>
			  <div id="domain-key"></div>
		</p>
		<h3>Find DOH Endpoint for a given Subdomain</h3>
		<p>
			  <input type="text" id="doh-for-domain" placeholder="mythingymajig.zenr.io">
			  <button onclick="findDOHEndpoint()">Find DOH endpoint</button>
			  <div id="domain-doh-endpoint"></div>
		</p>
		<h3>Import Key pair files from filesystem into Browser Keystore</h3>
		<p>
			<input type="file" id="input-key" accept=".key"/>
			<input type="file" id="input-private" accept=".private"/>
			<div id="imported-key"></div>
		</p>
		<script>
			/// Import Key from file pair
			///
			const streamToText = async (blob) => {
				const readableStream = await blob.getReader();
				const chunk = await readableStream.read();

				return new TextDecoder('utf-8').decode(chunk.value);
			};

			const bufferToText = (buffer) => {
				const bufferByteLength = buffer.byteLength;
				const bufferUint8Array = new Uint8Array(buffer, 0, bufferByteLength);

				return new TextDecoder().decode(bufferUint8Array);
			};

			document.getElementById('input-key').addEventListener('change', function(e) {
				let file = document.getElementById('input-key').files[0];

				(async () => {
					const fileContent = await file.text();

					console.log('.text()', fileContent);

					const fileContentStream = await file.stream();

					console.log('.stream()', await streamToText(fileContentStream));

					const buffer = await file.arrayBuffer();

					console.log('.buffer()', bufferToText(buffer));

					const fileSliceBlob = file.slice(0, file.length);
					const fileSliceBlobStream = await fileSliceBlob.stream();

					console.log('.slice() and .stream()', await streamToText(fileSliceBlobStream));
				})();
			});

			document.getElementById('input-private').addEventListener('change', function(e) {
				let file = document.getElementById('input-private').files[0];

				(async () => {
					const fileContent = await file.text();

					console.log('.text()', fileContent);

					const fileContentStream = await file.stream();

					console.log('.stream()', await streamToText(fileContentStream));

					const buffer = await file.arrayBuffer();

					console.log('.buffer()', bufferToText(buffer));

					const fileSliceBlob = file.slice(0, file.length);
					const fileSliceBlobStream = await fileSliceBlob.stream();

					console.log('.slice() and .stream()', await streamToText(fileSliceBlobStream));
				})();
			});
		</script>
	</body>
</html>
